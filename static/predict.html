<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <title>AI äººæ‰ç™¼å±•æ¨¡å‹ï½œç ”ç©¶ç‰ˆ Demo ï¼‹ Talent Compass</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg: #f3fbf7;
            --panel: #dde7f5;
            --card: #f5f7fb;
            --card-strong: #e4ecf8;
            --border: #7c8ba5;
            --accent: #f97316;
            --accent-soft: #ffedd5;
            --accent-strong: #ea580c;
            --text: #0f172a;
            --muted: #4b5563;
            --radius-xl: 22px;
            --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.18);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans TC",
                "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #e0f2fe 0, #f3fbf7 40%, #ecfdf3 100%);
            color: var(--text);
            line-height: 1.7;
            font-size: 18px;
        }

        .shell {
            max-width: 1180px;
            margin: 28px auto 40px;
            padding: 0 16px;
        }

        header {
            background: rgba(15, 23, 42, 0.95);
            color: #e5e7eb;
            padding: 18px 20px;
            border-radius: 26px;
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }

        header .title-block {
            flex: 1 1 260px;
        }

        header h1 {
            margin: 0 0 8px;
            font-size: 1.8rem;
            letter-spacing: 0.03em;
        }

        header p {
            margin: 0;
            font-size: 1.03rem;
            color: #cbd5f5;
        }

        header .nav {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 210px;
            align-items: flex-end;
        }

        header .nav a {
            color: #e5e7eb;
            text-decoration: none;
            font-size: 0.96rem;
            opacity: 0.9;
        }

        header .nav a span {
            font-size: 1.1rem;
            margin-right: 4px;
        }

        main {
            margin-top: 20px;
            display: grid;
            grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
            gap: 18px;
        }

        @media (max-width: 960px) {
            main {
                grid-template-columns: minmax(0, 1fr);
            }

            header .nav {
                align-items: flex-start;
            }
        }

        .panel {
            background: var(--panel);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(148, 163, 184, 0.9);
            padding: 16px;
            box-shadow: var(--shadow-soft);
        }

        .panel h2 {
            margin: 0 0 8px;
            font-size: 1.35rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            display: inline-flex;
            /* â­ è®“å®ƒè®Šæˆè† å›Šå®¹å™¨ */
            align-items: center;
            /* å‚ç›´ç½®ä¸­ */
            justify-content: center;
            /* æ°´å¹³ç½®ä¸­ */
            font-size: 0.9rem;
            padding: 3px 10px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.12);
            color: #e5e7eb;
            line-height: 1.1;
            /* é¿å…æ–‡å­—è²¼åˆ°ä¸Šç·£ */
        }


        .badge.light {
            background: rgba(15, 23, 42, 0.08);
            color: #0f172a;
        }

        .desc {
            margin: 0 0 10px;
            font-size: 0.98rem;
            color: var(--muted);
        }

        .step-card {
            background: var(--card);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.9);
            padding: 12px 14px;
            margin-bottom: 10px;
        }

        .step-title {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 4px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-top: 6px;
            font-size: 0.96rem;
        }

        label {
            font-size: 0.96rem;
        }

        input[type="file"],
        input[type="number"],
        input[type="text"] {
            font-size: 0.96rem;
            padding: 6px 8px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.9);
            background: #f9fafb;
            min-width: 0;
        }

        input[type="number"] {
            width: 120px;
        }

        button {
            border-radius: 999px;
            border: none;
            padding: 8px 15px;
            font-size: 0.96rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(to right, #0f766e, #22c55e);
            color: white;
            box-shadow: 0 8px 16px rgba(34, 197, 94, 0.4);
            margin-top: 6px;
        }

        button.secondary {
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.45);
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
        }

        .output-box {
            margin-top: 8px;
            border-radius: 14px;
            background: var(--card-strong);
            border: 1px solid rgba(148, 163, 184, 0.9);
            padding: 8px 10px;
            max-height: 260px;
            overflow: auto;
            font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo,
                Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin-top: 6px;
        }

        .feature-field {
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.9);
            padding: 6px 8px;
            font-size: 0.95rem;
        }

        .feature-field input[type="number"],
        .feature-field input[type="text"] {
            width: 100%;
            max-width: 100%;
        }

        .feature-field label {
            display: block;
            margin-bottom: 2px;
            font-weight: 500;
        }

        .feature-field small {
            display: block;
            margin-top: 2px;
            font-size: 0.8rem;
            color: var(--muted);
        }

        /* === å·¦å´é æ¸¬çµæœå€ï¼ˆæŠ€è¡“ç‰ˆï¼‰ === */
        .prediction-result {
            background: #f9fafb;
            color: #0f172a;
            border-radius: 18px;
            padding: 16px 18px;
            margin-top: 10px;
            border: 1px solid rgba(148, 163, 184, 0.9);
            font-size: 1rem;
            line-height: 1.8;
        }

        .prediction-result h3 {
            margin: 0 0 6px;
            font-size: 1.2rem;
            font-weight: 650;
        }

        .prediction-score {
            font-size: 2rem;
            font-weight: 750;
            color: #ca8a04;
        }

        .shap-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 0.98rem;
        }

        .shap-table th,
        .shap-table td {
            border: 1px solid rgba(148, 163, 184, 0.9);
            padding: 6px 8px;
            text-align: left;
        }

        .shap-table th {
            background: #0f172a;
            color: #f9fafb;
            font-weight: 650;
        }

        .shap-table tbody tr:nth-child(odd) {
            background: #ffffff;
        }

        .shap-table tbody tr:nth-child(even) {
            background: #e5edf7;
        }

        .aside-note {
            font-size: 0.95rem;
            color: var(--muted);
            margin-top: 6px;
        }

        /* === å³å´ Talent Compass å€ === */

        .tc-score-card {
            background: #0f172a;
            color: #e5e7eb;
            border-radius: 20px;
            padding: 14px 16px;
            border: 1px solid #020617;
            margin-bottom: 12px;
        }

        .tc-score-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tc-score-label {
            font-size: 0.98rem;
            opacity: 0.9;
        }

        .tc-score-number {
            font-size: 2.1rem;
            font-weight: 750;
            color: #facc15;
            margin-top: 4px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.88rem;
            border: 1px solid rgba(148, 163, 184, 0.9);
            background: #0b1120;
            color: #e5e7eb;
            gap: 4px;
            margin-left: 4px;
            white-space: nowrap;
        }

        .pill.level {
            background: #22c55e1a;
            border-color: #22c55e80;
            color: #bbf7d0;
        }

        .pill.cluster {
            background: #0ea5e91a;
            border-color: #38bdf880;
            color: #bae6fd;
        }

        .tc-score-note {
            font-size: 0.88rem;
            margin: 8px 0 0;
            color: #cbd5f5;
        }

        .tc-section-title {
            font-weight: 600;
            font-size: 1rem;
            margin: 10px 0 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tc-section-title span {
            font-size: 1.1rem;
        }

        .tc-list {
            margin: 4px 0 0 20px;
            padding-left: 0;
            font-size: 0.95rem;
        }

        .tc-list li+li {
            margin-top: 3px;
        }

        .tc-metrics {
            margin-top: 10px;
            padding: 8px 10px;
            border-radius: 14px;
            background: #f9fafb;
            border: 1px solid rgba(148, 163, 184, 0.9);
            font-size: 0.9rem;
        }

        .tc-metrics-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tc-metric-pill {
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px dashed rgba(148, 163, 184, 0.9);
            background: #ffffff;
            font-size: 0.88rem;
        }
    </style>
</head>

<body>
    <div class="shell">
        <header>
            <div class="title-block">
                <h1>å¯è§£é‡‹ AI äººæ‰ç™¼å±•æ¨¡å‹ï½œç ”ç©¶ç‰ˆ Demo ï¼‹ Talent Compass</h1>
                <p>ä¸Šå‚³ç ”ç©¶è³‡æ–™ â†’ å»ºç«‹æ¨¡å‹ â†’ è¼¸å…¥ä¸€ä½å“¡å·¥ â†’ å·¦é‚Šçœ‹æ¨¡å‹ã€å³é‚Šçœ‹äººæ‰ç¾…ç›¤å»ºè­°ã€‚</p>
            </div>
            <div class="nav">
                <a href="index.html" class="breadcrumb-link" data-keep-api><span>â†</span> å›åˆ°èªªæ˜é </a>
                <a href="sandbox.html" class="breadcrumb-link" data-keep-api>ğŸ§© è‡ªç”±åˆ†ç¾¤ç‰ˆæœ¬</a> <!-- â­ æ–°å¢é€™è¡Œ -->
                <a href="#" onclick="window.location.reload(); return false;">ğŸ”„ é‡æ–°æ•´ç†é é¢</a>
            </div>
        </header>

        <main>
            <!-- å·¦é‚Šï¼šè¨“ç·´ + ç‰¹å¾µè¼¸å…¥ + æŠ€è¡“é æ¸¬çµæœ -->
            <section class="panel">
                <h2>Step 1ï¼šä¸Šå‚³è³‡æ–™ & å»ºç«‹æ¨¡å‹ <span class="badge">ç ”ç©¶ç‰ˆ</span></h2>
                <p class="desc">
                    å…ˆä¸Šå‚³ä½ åœ¨ç ”ç©¶ä¸­ä½¿ç”¨çš„ <strong>å®Œæ•´è³‡æ–™é›†</strong>ï¼ˆåŒ…å« Performance_Scoreï¼‰ï¼Œå¾Œç«¯æœƒè¨“ç·´ RandomForest æ¨¡å‹ï¼Œ
                    ä¸¦è¨ˆç®—å‡ºã€Œæœ€é‡è¦çš„ç‰¹å¾µã€ä¾›ä¸‹ä¸€æ­¥è¼¸å…¥ã€‚
                </p>

                <div class="step-card">
                    <div class="step-title">1-1. ä¸Šå‚³è³‡æ–™ä¸¦è¨“ç·´</div>
                    <form id="train-form">
                        <div class="form-row">
                            <label>ä¸Šå‚³ CSVï¼š
                                <input type="file" id="train-file" accept=".csv" required />
                            </label>
                        </div>
                        <div class="form-row">
                            <label>æ¸¬è©¦é›†æ¯”ä¾‹ï¼š
                                <input type="number" id="test-size" value="0.2" step="0.05" min="0.1" max="0.4" />
                            </label>
                        </div>
                        <button type="submit" id="btn-train">ğŸš€ å»ºç«‹æ¨¡å‹</button>
                    </form>
                    <div class="output-box" id="train-output">å°šæœªè¨“ç·´æ¨¡å‹ã€‚</div>
                </div>

                <div class="step-card">
                    <div class="step-title">1-2. è¼¸å…¥ä¸€ä½ã€Œå“¡å·¥ã€çš„é—œéµç‰¹å¾µ</div>
                    <p class="desc">
                        ä¸‹æ–¹æ¬„ä½æœƒæ ¹æ“šé‡è¦åº¦ï¼ˆå®Œæ•´ç‰ˆæœƒç”¨ SHAPï¼Œè¼•é‡ç‰ˆç”¨ RF é‡è¦åº¦ï¼‰è‡ªå‹•å¸¶å‡ºå‰å¹¾åç‰¹å¾µï¼Œé è¨­å€¼ä¾†è‡ªè¨“ç·´è³‡æ–™çš„ã€Œä¸­ä½æ•¸ï¼çœ¾æ•¸ã€ã€‚
                        ä½ å¯ä»¥ä¿®æ”¹å…¶ä¸­å¹¾å€‹æ¬„ä½ï¼Œçœ‹çœ‹æ¨¡å‹å¦‚ä½•æ”¹è®Šé æ¸¬ã€‚
                    </p>
                    <div id="shapNotice" style="display:none; margin:10px 0; padding:10px 12px; border-radius:12px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12);">
  <strong>è¼•é‡ç‰ˆæç¤ºï¼š</strong>æœªå®‰è£ SHAPï¼ˆçœè³‡æºï¼‰ï¼Œé€™è£¡æ”¹é¡¯ç¤º RandomForest çš„ç‰¹å¾µé‡è¦åº¦ã€‚
</div>
<div id="feature-form">
                        <p class="aside-note">è«‹å…ˆå®Œæˆä¸Šæ–¹ã€Œå»ºç«‹æ¨¡å‹ã€ï¼Œé€™è£¡æ‰æœƒå‡ºç¾å¯è¼¸å…¥çš„æ¬„ä½ã€‚</p>
                    </div>
                    <button type="button" id="btn-predict" disabled>ğŸ“ˆ é æ¸¬ç¸¾æ•ˆåˆ†æ•¸ & æ›´æ–° Talent Compass</button>

                    <div class="prediction-result" id="prediction-block" style="display:none;">
                        <h3>é æ¸¬çµæœï¼ˆæ¨¡å‹æŠ€è¡“è¦–è§’ï¼‰</h3>
                        <div>é æ¸¬ç¸¾æ•ˆåˆ†æ•¸ï¼ˆPerformance_Scoreï¼‰ï¼š</div>
                        <div class="prediction-score" id="prediction-score">-</div>
                        <div class="aside-note">
                            æ•¸å€¼æ„ˆé«˜ä»£è¡¨æ¨¡å‹åˆ¤å®šè©²å“¡å·¥ã€Œæ•´é«”ç¸¾æ•ˆæŒ‡æ¨™ã€æ„ˆé«˜ã€‚æ­¤åˆ†æ•¸ç”¨ä¾†è¼”åŠ©åˆ¤æ–·ï¼Œä¸å–ä»£ä¸»ç®¡æ±ºç­–ã€‚
                        </div>

                        <h3 id="explainTitle" style="margin-top:10px;">ä¸»è¦å½±éŸ¿å› å­ï¼ˆSHAP Top 10ï¼‰</h3>
                        <div class="aside-note">
                            æ­£å€¼ä»£è¡¨ã€ŒæŠŠåˆ†æ•¸å¾€ä¸Šæ‹‰ã€ï¼›è² å€¼ä»£è¡¨ã€ŒæŠŠåˆ†æ•¸å¾€ä¸‹æ‹‰ã€ã€‚çµ•å°å€¼æ„ˆå¤§ï¼Œä»£è¡¨å½±éŸ¿åŠ›æ„ˆå¼·ã€‚
                        </div>
                        <table class="shap-table" id="shap-table">
                            <thead>
                                <tr>
                                    <th>ç‰¹å¾µ</th>
                                    <th id="explainColVal">SHAP å€¼</th>
                                    <th id="explainColRank">|SHAP| æ’å</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- å³é‚Šï¼šTalent Compass è§£è®€å€ -->
            <section class="panel">
                <h2>Step 2ï¼šè§€çœ‹æ¨¡å‹åˆ¤è®€ & äººæ‰ç™¼å±•å»ºè­° <span class="badge">Talent Compass</span></h2>

                <div class="tc-score-card">
                    <div class="tc-score-row">
                        <div>
                            <div class="tc-score-label">é æ¸¬ç¸¾æ•ˆåˆ†æ•¸ï¼ˆPerformance_Scoreï¼‰</div>
                            <div class="tc-score-number" id="tc-score-number">-</div>
                        </div>
                        <div>
                            <span class="pill level" id="tc-perf-level">å°šæœªé æ¸¬</span>
                            <span class="pill cluster" id="tc-cluster-name">â€”</span>
                        </div>
                    </div>
                    <p class="tc-score-note" id="tc-score-note">
                        è«‹å…ˆåœ¨å·¦å´è¼¸å…¥ä¸€ä½å“¡å·¥çš„æ¢ä»¶ï¼ŒæŒ‰ä¸‹ã€Œé æ¸¬ç¸¾æ•ˆåˆ†æ•¸ã€ï¼Œé€™è£¡æœƒé¡¯ç¤ºæ‰€å±¬äººæ‰ç¾¤çµ„èˆ‡æ–‡å­—å»ºè­°ã€‚
                    </p>
                </div>

                <div class="step-card">
                    <div class="tc-section-title"><span>ğŸŒ±</span> å»ºè­°çš„ç™¼å±•é‡é»</div>
                    <ul class="tc-list" id="tc-dev-points">
                        <li>å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚</li>
                    </ul>

                    <div class="tc-section-title" style="margin-top:10px;"><span>âš ï¸</span> é¢¨éšªèˆ‡æé†’</div>
                    <ul class="tc-list" id="tc-risk-alerts">
                        <li>å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚</li>
                    </ul>

                    <div class="tc-section-title" style="margin-top:10px;"><span>ğŸ‘”</span> å»ºè­°çµ¦ HRï¼ä¸»ç®¡è¡Œå‹•</div>
                    <ul class="tc-list" id="tc-hr-tips">
                        <li>å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚</li>
                    </ul>
                </div>

                <div class="step-card">
                    <div class="tc-section-title"><span>ğŸ“Š</span> æ¨¡å‹è©•ä¼°æŒ‡æ¨™ï¼ˆæ‘˜è¦ï¼‰</div>
                    <div class="tc-metrics">
                        <div class="tc-metrics-row">
                            <div class="tc-metric-pill" id="tc-metric-rf">
                                RandomForestï¼šå°šæœªè¨“ç·´
                            </div>
                            <div class="tc-metric-pill" id="tc-metric-en">
                                ElasticNetï¼šå°šæœªè¨“ç·´
                            </div>
                        </div>
                        <p class="aside-note" style="margin-top:8px;">
                            æŒ‡æ¨™ç‚ºæ•´é«”æ¨¡å‹åœ¨æ¸¬è©¦è³‡æ–™ä¸Šçš„è¡¨ç¾ï¼Œç”¨ä¾†è©•ä¼°ã€Œæ¨¡å‹å¯ä¿¡åº¦ã€ï¼Œä¸ä»£è¡¨å€‹åˆ¥å“¡å·¥çš„çœŸå¯¦ç¸¾æ•ˆã€‚
                        </p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function resolveApiBase() {
            try {
                const url = new URL(window.location.href);
                const apiParam = url.searchParams.get("api");

                // è‹¥ç¶²å€ä¸Šæœ‰ ?api=ï¼Œå„ªå…ˆç”¨å®ƒä¸¦è¨˜åˆ° localStorage
                if (apiParam) {
                    const clean = apiParam.replace(/\/+$/, "");
                    localStorage.setItem("talent_api_base", clean);
                    return clean;
                }

                // è‹¥æ›¾ç¶“å­˜éï¼Œå°±æ²¿ç”¨
                const saved = localStorage.getItem("talent_api_base");
                if (saved) {
                    return saved;
                }

                // å¦‚æœå‰å¾Œç«¯æ˜¯åŒä¸€å€‹ domainï¼ˆä¾‹å¦‚ä½ ä¹‹å¾Œæ”¾åˆ°åŒä¸€å° serverï¼‰
                if (window.location.protocol.startsWith("http")) {
                    return window.location.origin;  // ä¾‹å¦‚ https://yourhost.com
                }

                // é–‹ç™¼æ™‚æˆ– file:// å°±æŒ‡åˆ°æœ¬æ©Ÿ 8000
                return "http://127.0.0.1:8000";
            } catch (e) {
                console.warn("è§£æ API_BASE å¤±æ•—ï¼Œé€€å›æœ¬æ©Ÿ 8000ï¼š", e);
                return "http://127.0.0.1:8000";
            }
        }

        const API_BASE = resolveApiBase();



        // è®“ ?api= åƒæ•¸åœ¨é é¢ä¹‹é–“è‡ªå‹•å»¶çºŒ
        (function propagateApiParam() {
            try {
                const url = new URL(window.location.href);
                const apiParam = url.searchParams.get("api");
                if (!apiParam) return;

                document.querySelectorAll("a[data-keep-api]").forEach((a) => {
                    const target = new URL(a.getAttribute("href"), window.location.href);
                    target.searchParams.set("api", apiParam);
                    a.href = target.toString();
                });
            } catch (e) {
                console.warn("propagateApiParam å¤±æ•—ï¼š", e);
            }
        })();






        // ğŸ”¹ å›ºå®šç‰ˆäººæ‰ç¾…ç›¤æ¨¡æ¿ï¼ˆå°æ‡‰è«–æ–‡ 5.2.3 ç¯€ï¼šC0~C3ï¼‰
        const TALENT_CLUSTER_TEMPLATES = {
            0: {
                name: "é«˜ç—…å‡å£“åŠ›å‹ (C0)",
                short_title: "ä½è–ªã€å£“åŠ›è¨Šè™Ÿæ˜é¡¯ï¼Œå¥åº·é¢¨éšªè¼ƒé«˜",
                summary: "è–ªè³‡èˆ‡ç¸¾æ•ˆåä½ï¼Œä½†ç—…å‡å¤©æ•¸æœ€é«˜ï¼ˆç´„ 11 å¤©ï¼‰ï¼Œé¡¯ç¤ºå¯èƒ½è™•æ–¼é«˜å£“æˆ–å¥åº·å¤±è¡¡ç‹€æ…‹ã€‚",
                dev_focus: [
                    "å„ªå…ˆæª¢è¦–å·¥ä½œè² è·èˆ‡æ’ç­ï¼Œé—œæ³¨èº«å¿ƒå¥åº·è³‡æºã€‚",
                    "æä¾›å£“åŠ›ç®¡ç†èˆ‡åŸºç¤è·èƒ½è¨“ç·´ï¼Œå…ˆæ±‚ç©©å®šå†æ±‚ç¸¾æ•ˆã€‚",
                    "é‡æ¸…æ˜¯èƒ½åŠ›å•é¡Œé‚„æ˜¯å·¥ä½œè¨­è¨ˆå°è‡´çš„å€¦æ€ ã€‚"
                ],
                risk_alerts: [
                    "é«˜ç—…å‡ç‡æ˜¯æ˜é¡¯çš„é›¢è·æˆ–éå‹å‰å…†ã€‚",
                    "è‹¥åªç”¨ç¸¾æ•ˆæ–½å£“ï¼Œå¯èƒ½å°è‡´ç¼ºå‹¤ç‹€æ³æ›´æƒ¡åŒ–ã€‚"
                ],
                hr_tips: [
                    "ä¸»å‹•é€²è¡Œé—œæ‡·è¨ªè«‡ï¼ˆEAPï¼‰ï¼Œäº†è§£è«‹å‡èƒŒå¾Œçš„çœŸå¯¦åŸå› ã€‚",
                    "æš«ä¸å®œè³¦äºˆéé«˜å¼·åº¦çš„å°ˆæ¡ˆï¼Œæ‡‰å…ˆèª¿æ•´å·¥ä½œé‡é…ç½®ã€‚",
                    "æª¢æŸ¥æ˜¯å¦æœ‰ã€ä½è–ªå»é«˜è²¬ã€çš„çµæ§‹æ€§å•é¡Œã€‚"
                ]
            },
            1: {
                name: "ç©©å¥è³‡æºå‹ (C1)",
                short_title: "é«˜è–ªã€ä½åŠ ç­ã€ç¸¾æ•ˆç©©å¥çš„æ ¸å¿ƒäººæ‰",
                summary: "è–ªè³‡è¼ƒå„ªæ¸¥ï¼ŒåŠ ç­æœ€å°‘ï¼Œç¸¾æ•ˆä¸­é«˜ä¸”ç©©å®šï¼Œå±¬æ–¼çµ„ç¹”å…§çš„ç©©å¥æ ¸å¿ƒåŠ›é‡ã€‚",
                dev_focus: [
                    "è³¦äºˆè·¨éƒ¨é–€å°ˆæ¡ˆæˆ–å°å¸«ï¼ˆMentorï¼‰è§’è‰²ï¼Œæ“´å¤§å½±éŸ¿åŠ›ã€‚",
                    "é¼“å‹µçŸ¥è­˜åˆ†äº«ï¼Œå°‡å…¶ç¶“é©—è½‰åŒ–ç‚ºçµ„ç¹”è³‡ç”¢ã€‚",
                    "ç¶­æŒå…¶æ»¿æ„åº¦ï¼Œé¿å…å› ç¼ºä¹æŒ‘æˆ°è€Œåœæ»¯ã€‚"
                ],
                risk_alerts: [
                    "é›–è¡¨ç¾ç©©å®šï¼Œä½†è‹¥ç¼ºä¹æ–°æŒ‘æˆ°ï¼Œå¯èƒ½ç”¢ç”Ÿèˆ’é©åœˆå¿ƒæ…‹ã€‚",
                    "éœ€æ³¨æ„æ˜¯å¦å› ã€å¤ªå¥½ç”¨ã€è€Œæœªè¢«è¦åŠƒé•·æœŸå‡é·è·¯å¾‘ã€‚"
                ],
                hr_tips: [
                    "å°‡å…¶ç´å…¥å…§éƒ¨è¬›å¸«æˆ–æ¥ç­äººè¨ˆç•«ï¼ˆSuccession Planï¼‰ã€‚",
                    "å®šæœŸè¨è«–è·æ¶¯ä¸‹ä¸€æ­¥ï¼Œç¢ºèªå…¶å°ç¾ç‹€çš„æ»¿æ„åº¦ã€‚",
                    "å¯ä½œç‚ºæ–°é€²å“¡å·¥çš„ç©©å®šå¸¶é ˜è€…ã€‚"
                ]
            },
            2: {
                name: "é«˜æŠ•å…¥æˆé•·å‹ (C2)",
                short_title: "é«˜è–ªã€é«˜åŠ ç­ã€æœ€é«˜ç¸¾æ•ˆçš„è¡åˆºè€…",
                summary: "ç¸¾æ•ˆèˆ‡è–ªè³‡çš†æœ€é«˜ï¼Œä½†åŠ ç­æ™‚æ•¸ä¹Ÿæœ€é«˜ï¼ˆæ¯é€±ç´„ 22 å°æ™‚ï¼‰ï¼Œæ˜¯å…¸å‹çš„ã€Œé«˜æŠ•å…¥é«˜ç”¢å‡ºã€æ—ç¾¤ã€‚",
                dev_focus: [
                    "è¨­è¨ˆéšæ®µæ€§æŒ‘æˆ°èˆ‡æ˜ç¢ºæ™‰å‡éšæ¢¯ï¼Œå°‡æŠ•å…¥è½‰åŒ–ç‚ºè·æ¶¯è³‡æœ¬ã€‚",
                    "åŸ¹é¤Šç®¡ç†è·èƒ½æˆ–å°ˆæ¡ˆç®¡ç†èƒ½åŠ›ï¼Œæ¸›å°‘ç´”é«”åŠ›åŠ ç­ã€‚",
                    "å¼·åˆ¶æ€§çš„ä¼‘æ¯æˆ–ä¼‘å‡æ©Ÿåˆ¶ï¼Œé¿å…ç‡ƒç‡’æ®†ç›¡ï¼ˆBurnoutï¼‰ã€‚"
                ],
                risk_alerts: [
                    "é•·æœŸé«˜å·¥æ™‚æ˜¯é›™é¢åˆƒï¼Œæ¥µæ˜“å°è‡´çªç„¶çš„å€¦æ€ æˆ–è·³æ§½ã€‚",
                    "å¯èƒ½éåº¦ä¾è³´ã€åŠ ç­ã€ä¾†æ›å–ç¸¾æ•ˆï¼Œè€Œéæå‡æ•ˆç‡ã€‚"
                ],
                hr_tips: [
                    "å¯†åˆ‡ç›£æ§å·¥æ™‚æ•¸æ“šï¼Œè‹¥é€£çºŒæ•¸æœˆéé«˜éœ€å¼·åˆ¶ä»‹å…¥ã€‚",
                    "çµ¦äºˆé«˜èƒ½è¦‹åº¦çš„çå‹µæˆ–å…¬é–‹è¡¨æšï¼Œæ»¿è¶³å…¶æˆå°±å‹•æ©Ÿã€‚",
                    "ç¢ºèªè–ªé…¬èˆ‡çé‡‘æ˜¯å¦èˆ‡å…¶é«˜æŠ•å…¥ç›¸ç¬¦ï¼Œç¢ºä¿å…¬å¹³æ€§ã€‚"
                ]
            },
            3: {
                name: "æ–°ç§€æ½›åŠ›å‹ (C3)",
                short_title: "ä½è–ªã€é«˜å·¥æ™‚ã€é«˜è¨“ç·´ã€æ¥µå°‘è«‹å‡",
                summary: "è–ªè³‡åä½ä½†å·¥æ™‚é•·ï¼Œè¨“ç·´æ™‚æ•¸é«˜ä¸”å¹¾ä¹ä¸è«‹ç—…å‡ï¼Œé¡¯ç¤ºç‚ºç©æ¥µå­¸ç¿’ä½†ç¸¾æ•ˆå°šæœªå®Œå…¨å±•ç¾çš„æ–°ç§€ã€‚",
                dev_focus: [
                    "å»ºç«‹æ¸…æ™°çš„ã€èƒ½åŠ›éšæ¢¯ã€ï¼Œè®“ä»–çŸ¥é“åŠªåŠ›å¾Œçš„å…·é«”å›å ±ã€‚",
                    "æä¾›å³æ™‚çš„ç¸¾æ•ˆå›é¥‹ï¼ˆFeedbackï¼‰ï¼Œç¸®çŸ­å­¸ç¿’æ›²ç·šã€‚",
                    "æ­é…è³‡æ·±å°å¸«ï¼ˆå¦‚ C1 é¡å‹ï¼‰å¸¶é ˜ï¼Œé¿å…ç„¡æ•ˆåŠªåŠ›ã€‚"
                ],
                risk_alerts: [
                    "é«˜æŠ•å…¥å»ä½å›å ±ï¼ˆä½è–ª/ä½ç¸¾æ•ˆï¼‰çš„ç‹€æ…‹ä¸èƒ½ç¶­æŒå¤ªä¹…ï¼Œå¦å‰‡å‹•æ©Ÿæ˜“å´©ç›¤ã€‚",
                    "è‹¥é•·æœŸæœªè¦‹èµ·è‰²ï¼Œéœ€æª¢è¦–æ˜¯å¦è¨“ç·´æ–¹å‘éŒ¯èª¤ã€‚"
                ],
                hr_tips: [
                    "æ˜ç¢ºæºé€šå‡é·æ¨™æº–èˆ‡æ™‚ç¨‹ï¼Œçµ¦äºˆã€è·æ¶¯å¸Œæœ›æ„Ÿã€ã€‚",
                    "å¤šçµ¦äºˆéç‰©è³ªçš„é¼“å‹µï¼ˆå¦‚åƒèˆ‡é‡è¦æœƒè­°ã€å­¸ç¿’æ©Ÿæœƒï¼‰ã€‚",
                    "å®šæœŸæª¢æ ¸è¨“ç·´æˆæ•ˆï¼Œç¢ºä¿æŠ•å…¥èƒ½è½‰æ›ç‚ºå¯¦éš›ç”¢å‡ºã€‚"
                ]
            }
        };


        let topFeatures = []; // å¾å¾Œç«¯æ‹¿åˆ°çš„ã€Œé‡è¦ç‰¹å¾µï¼‹é è¨­å€¼ã€
        const featureFormEl = document.getElementById("feature-form");

        function pretty(obj) {
            try {
                return JSON.stringify(obj, null, 2);
            } catch {
                return String(obj);
            }
        }

        function applyExplainMode(hasShap) {
            const titleEl = document.getElementById("explainTitle");
            const descEl = document.getElementById("explainDesc");
            const colValEl = document.getElementById("explainColVal");
            const colRankEl = document.getElementById("explainColRank");
            if (!titleEl || !descEl || !colValEl || !colRankEl) return;

            if (hasShap) {
                titleEl.textContent = "ä¸»è¦å½±éŸ¿å› å­ï¼ˆSHAP Top 10ï¼‰";
                descEl.textContent = "æ­£å€¼ä»£è¡¨ã€ŒæŠŠåˆ†æ•¸å¾€ä¸Šæ‹‰ã€ï¼Œè² å€¼ä»£è¡¨ã€ŒæŠŠåˆ†æ•¸å¾€ä¸‹æ‹‰ã€ã€‚çµ•å°å€¼æ„ˆå¤§ï¼Œä»£è¡¨å½±éŸ¿åŠ›æ„ˆå¼·ã€‚";
                colValEl.textContent = "SHAP å€¼";
                colRankEl.textContent = "|SHAP| æ’å";
            } else {
                titleEl.textContent = "ä¸»è¦å½±éŸ¿å› å­ï¼ˆé‡è¦åº¦ Top 10ï¼‰";
                descEl.textContent = "æ­¤ç‚º RandomForest çš„å…¨åŸŸç‰¹å¾µé‡è¦åº¦ï¼ˆéå€‹æ¡ˆ SHAPï¼‰ã€‚æ•¸å€¼æ„ˆå¤§ä»£è¡¨è¶Šé‡è¦ã€‚";
                colValEl.textContent = "é‡è¦åº¦";
                colRankEl.textContent = "æ’å";
            }
        }

        async function trainModel(event) {
            event.preventDefault();
            const fileInput = document.getElementById("train-file");
            const testSizeInput = document.getElementById("test-size");
            const outputEl = document.getElementById("train-output");
            const btnTrain = document.getElementById("btn-train");

            if (!fileInput.files[0]) {
                alert("è«‹å…ˆé¸æ“‡ CSV æª”æ¡ˆ");
                return;
            }

            const fd = new FormData();
            fd.append("file", fileInput.files[0]);
            fd.append("test_size", testSizeInput.value || "0.2");

            outputEl.textContent = "å¾Œç«¯è¨“ç·´ä¸­ï¼Œè«‹ç¨å€™â€¦";
            btnTrain.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/api/train_model`, {
                    method: "POST",
                    body: fd,
                });
                if (!res.ok) {
                    const text = await res.text();
                    throw new Error(`HTTP ${res.status}: ${text}`);
                }
                const data = await res.json();
                applyExplainMode(!!data.has_shap);
                topFeatures = data.top_features || [];
                const hasShap = !!data.has_shap;
                const shapNotice = document.getElementById("shapNotice");
                if (shapNotice) shapNotice.style.display = hasShap ? "none" : "block";
                applyExplainMode(hasShap);


                outputEl.textContent = pretty({
                    rows: data.n_rows,
                    n_features: data.n_features,
                    target_col: data.target_col,
                    metrics: data.metrics,
                    top_features_preview: topFeatures.map((f) => ({
                        feature: f.feature,
                        mean_abs_shap: f.mean_abs_shap,
                        default: f.default,
                    })),
                });

                renderFeatureForm(topFeatures);
                document.getElementById("btn-predict").disabled = false;
                // åŒæ­¥æ›´æ–°å³å´æŒ‡æ¨™
                updateMetricsFromSummary();
            } catch (err) {
                console.error(err);
                outputEl.textContent = `âŒ è¨“ç·´å¤±æ•—ï¼š${err.message}`;
            } finally {
                btnTrain.disabled = false;
            }
        }

        function renderFeatureForm(features) {
            if (!features || !Array.isArray(features)) {
                features = topFeatures;
            }

            featureFormEl.innerHTML = "";

            const info = document.createElement("p");
            info.style.fontSize = "0.86rem";
            info.style.color = "#64748b";
            info.textContent =
                "ä¸‹åˆ—æ¬„ä½ç‚ºæ¨¡å‹æœ€é‡è¦çš„å‰å¹¾å€‹ç‰¹å¾µã€‚æ•¸å€¼æ¬„ä½è«‹è¼¸å…¥åˆç†æ•¸å­—ï¼›æ–‡å­—æ¬„ä½è«‹ç›¡é‡ä½¿ç”¨æç¤ºä¸­çš„ã€Œå¸¸è¦‹å€¼ç¯„ä¾‹ã€ã€‚æ¬„ä½ç•™ç™½æ™‚ï¼Œæœƒä½¿ç”¨è¨“ç·´è³‡æ–™çš„é è¨­å€¼ã€‚";
            featureFormEl.appendChild(info);

            const grid = document.createElement("div");
            grid.className = "feature-grid";
            featureFormEl.appendChild(grid);

            features.forEach((f) => {
                const field = document.createElement("div");
                field.className = "feature-field";

                const label = document.createElement("label");
                label.textContent = f.feature;
                field.appendChild(label);

                const input = document.createElement("input");
                const isNumeric =
                    f.value_type === "number" || typeof f.default === "number";

                if (isNumeric) {
                    input.type = "number";
                    input.step = "0.01";
                } else {
                    input.type = "text";
                }
                if (f.default !== null && f.default !== undefined) {
                    input.value = f.default;
                }

                input.dataset.feature = f.feature;
                field.appendChild(input);

                const small = document.createElement("small");
                const parts = [];
                if (f.hint) parts.push(f.hint);
                parts.push(
                    `å½±éŸ¿åŠ› / é‡è¦åº¦ï¼š${(f.mean_abs_shap || 0).toFixed(4)}`
                );
                small.textContent = parts.join("ï½œ");
                field.appendChild(small);

                grid.appendChild(field);
            });
        }

        function collectFeaturePayload() {
            const featureInputs = document.querySelectorAll("[data-feature]");
            const payload = { features: {} };

            featureInputs.forEach((input) => {
                const name = input.getAttribute("data-feature");
                let val = input.value;
                if (val === "") {
                    return; // ç©ºå€¼ â†’ è®“å¾Œç«¯ç”¨é è¨­å€¼
                }
                if (!isNaN(val) && val.trim() !== "") {
                    const num = Number(val);
                    if (!Number.isNaN(num)) {
                        val = num;
                    }
                }
                payload.features[name] = val;
            });

            return payload;
        }

        async function predictOnce() {
            const btn = document.getElementById("btn-predict");
            const scoreEl = document.getElementById("prediction-score");
            const blockEl = document.getElementById("prediction-block");
            const tableBody = document.querySelector("#shap-table tbody");

            if (!topFeatures.length) {
                alert("è«‹å…ˆå»ºç«‹æ¨¡å‹ï¼ˆStep 1ï¼‰");
                return;
            }

            const payload = collectFeaturePayload();

            btn.disabled = true;
            btn.textContent = "é æ¸¬ä¸­â€¦";

            try {
                // åŒæ™‚å‘¼å«ï¼š/api/predictï¼ˆæŠ€è¡“ï¼‰ï¼‹ /api/talent_compass_predictï¼ˆç¾…ç›¤ï¼‰
                const [resPred, resCompass] = await Promise.all([
                    fetch(`${API_BASE}/api/predict`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload),
                    }),
                    fetch(`${API_BASE}/api/talent_compass_predict`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload),
                    }),
                ]);

                if (!resPred.ok) {
                    const text = await resPred.text();
                    throw new Error(`é æ¸¬ API å¤±æ•—ï¼šHTTP ${resPred.status} ${text}`);
                }
                if (!resCompass.ok) {
                    const text = await resCompass.text();
                    throw new Error(`Talent Compass API å¤±æ•—ï¼šHTTP ${resCompass.status} ${text}`);
                }

                const dataPred = await resPred.json();
                const dataCompass = await resCompass.json();
                console.log("DEBUG talent_compass_predict å›å‚³ï¼š", dataCompass);


                // ===== å·¦å´ï¼šæ›´æ–°æ¨¡å‹é æ¸¬èˆ‡ SHAP =====
                const predVal = typeof dataPred.prediction === "number"
                    ? dataPred.prediction
                    : (typeof dataPred.performance_score === "number"
                        ? dataPred.performance_score
                        : NaN);
                if (!Number.isNaN(predVal)) {
                    scoreEl.textContent = predVal.toFixed(3);
                } else {
                    scoreEl.textContent = "-";
                }
                blockEl.style.display = "block";

                tableBody.innerHTML = "";
                (dataPred.shap_top_contrib || []).forEach((row, idx) => {
                    const tr = document.createElement("tr");
                    const tdFeature = document.createElement("td");
                    tdFeature.textContent = row.feature;
                    const tdVal = document.createElement("td");
                    tdVal.textContent = row.shap_value.toFixed(5);
                    const tdRank = document.createElement("td");
                    tdRank.textContent = `#${idx + 1}`;
                    tr.appendChild(tdFeature);
                    tr.appendChild(tdVal);
                    tr.appendChild(tdRank);
                    tableBody.appendChild(tr);
                });

                // ===== å³å´ï¼šæ›´æ–° Talent Compass å…§å®¹ =====
                updateTalentCompass(dataCompass, predVal);
                updateMetricsFromSummary(); // åŒæ­¥æ›´æ–°æ¨¡å‹æŒ‡æ¨™ï¼ˆå¦‚æœé‚„æ²’æ›´æ–°éï¼‰

            } catch (err) {
                alert(`é æ¸¬å¤±æ•—ï¼š${err.message}`);
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.textContent = "ğŸ“ˆ é æ¸¬ç¸¾æ•ˆåˆ†æ•¸ & æ›´æ–° Talent Compass";
            }
        }


        function fillList(element, items, emptyMsg) {
            element.innerHTML = "";
            if (!items || !items.length) {
                const li = document.createElement("li");
                li.textContent = emptyMsg;
                element.appendChild(li);
                return;
            }
            items.forEach((txt) => {
                const li = document.createElement("li");
                li.textContent = txt;
                element.appendChild(li);
            });
        }

        function updateTalentCompass(tc, fallbackPredVal) {
            const scoreNumberEl = document.getElementById("tc-score-number");
            const perfLevelEl = document.getElementById("tc-perf-level");
            const clusterNameEl = document.getElementById("tc-cluster-name");
            const noteEl = document.getElementById("tc-score-note");
            const devListEl = document.getElementById("tc-dev-points");
            const riskListEl = document.getElementById("tc-risk-alerts");
            const hrListEl = document.getElementById("tc-hr-tips");

            if (!tc || typeof tc !== "object") {
                scoreNumberEl.textContent = "-";
                perfLevelEl.textContent = "å°šæœªé æ¸¬";
                clusterNameEl.textContent = "â€”";
                noteEl.textContent = "æœªå–å¾— Talent Compass å›å‚³å…§å®¹ã€‚";
                fillList(devListEl, null, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
                fillList(riskListEl, null, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
                fillList(hrListEl, null, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
                return;
            }

            // ğŸ”¹ åˆ†æ•¸
            const predVal = typeof tc.prediction === "number"
                ? tc.prediction
                : (typeof tc.performance_score === "number"
                    ? tc.performance_score
                    : (typeof fallbackPredVal === "number" ? fallbackPredVal : NaN));

            if (!Number.isNaN(predVal)) {
                scoreNumberEl.textContent = predVal.toFixed(3);
            } else {
                scoreNumberEl.textContent = "-";
            }

            // ğŸ”¹ ç¸¾æ•ˆç­‰ç´šï¼šä¸€å¾‹ç”¨ä¸­æ–‡ HR èªè¨€
            const bandCode = tc.performance_band;
            let perfLevel =
                tc.perf_level ||
                tc.performance_level ||
                (bandCode === "high"
                    ? "è¼ƒé«˜ç¸¾æ•ˆå¸¶"
                    : bandCode === "low"
                        ? "ç›¸å°åä½ç¸¾æ•ˆå¸¶"
                        : bandCode === "medium"
                            ? "ä¸­ç­‰ç¸¾æ•ˆå¸¶"
                            : "å°šæœªæ¨™å®šç­‰ç´š");
            perfLevelEl.textContent = perfLevel;

            // ğŸ”¹ äººæ‰ç¾¤çµ„åç¨±
            const clusterId = typeof tc.cluster_id === "number" ? tc.cluster_id : null;
            const clusterName =
                tc.cluster_name ||
                (clusterId !== null ? `ç¬¬ ${clusterId} ç¾¤` : "â€”");
            clusterNameEl.textContent = clusterName;

            // ğŸ”¹ æ‰¾å°æ‡‰çš„æ¨¡æ¿ï¼ˆå„ªå…ˆç”¨ idï¼Œå…¶æ¬¡ç”¨åç¨±ï¼‰
            const tpl =
                (clusterId !== null ? TALENT_CLUSTER_TEMPLATES[clusterId] : null) ||
                TALENT_CLUSTER_TEMPLATES[clusterName] ||
                null;

            // ğŸ”¹ ä¸Šæ–¹é‚£è¡ŒçŸ­èªªæ˜ï¼ˆç¾¤çµ„ä¸€å¥è©±ï¼‹å¯é¸çš„ç™¾åˆ†ä½ï¼‰
            const percentile = typeof tc.percentile === "number"
                ? (tc.percentile * 100).toFixed(1) + "%"
                : null;
            const shortTitle =
                tc.cluster_short_title ||
                (tpl && tpl.short_title) ||
                "";

            if (shortTitle && percentile) {
                noteEl.textContent = `${shortTitle}ï¼ˆç´„è½åœ¨æ•´é«”æ¨£æœ¬çš„ç¬¬ ${percentile} ç™¾åˆ†ä½ï¼‰`;
            } else if (shortTitle) {
                noteEl.textContent = shortTitle;
            } else if (percentile) {
                noteEl.textContent =
                    `ç´„è½åœ¨æ•´é«”æ¨£æœ¬çš„ç¬¬ ${percentile} ç™¾åˆ†ä½ã€‚å»ºè­°æ­é…å·¦å´ SHAP çµæœèˆ‡å¯¦éš›ç¸¾æ•ˆç´€éŒ„ä¸€èµ·è¨è«–ã€‚`;
            } else if (tpl && tpl.summary) {
                noteEl.textContent = tpl.summary;
            } else {
                noteEl.textContent =
                    "æ­¤çµæœç‚ºç ”ç©¶æ¨¡å‹çš„æ©Ÿå™¨å­¸ç¿’åˆ¤æ–·ï¼Œå»ºè­°æ­é…å¯¦å‹™è§€å¯Ÿèˆ‡ä¸»ç®¡è©•ä¼°ä¸€ä½µä½¿ç”¨ã€‚";
            }

            // ğŸ”¹ ä¸‰ç¨®æ–‡å­—å»ºè­°ï¼šå…ˆåƒå¾Œç«¯ï¼Œå¦‚æœæ˜¯ç©ºçš„å°±ç”¨æ¨¡æ¿è£œ
            let devPoints =
                tc.dev_points ||
                tc.development_points ||
                tc.dev_focus ||
                [];
            let riskAlerts =
                tc.risk_alerts ||
                tc.risk_points ||
                [];
            let hrTips =
                tc.hr_tips ||
                tc.hr_actions ||
                tc.manager_actions ||
                [];

            if (tpl) {
                if (!devPoints || !devPoints.length) devPoints = tpl.dev_focus;
                if (!riskAlerts || !riskAlerts.length) riskAlerts = tpl.risk_alerts;
                if (!hrTips || !hrTips.length) hrTips = tpl.hr_tips;
            }

            fillList(devListEl, devPoints, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
            fillList(riskListEl, riskAlerts, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
            fillList(hrListEl, hrTips, "å°šæœªé æ¸¬ï¼Œæš«ç„¡å…§å®¹ã€‚");
        }




        async function updateMetricsFromSummary() {
            const rfEl = document.getElementById("tc-metric-rf");
            const enEl = document.getElementById("tc-metric-en");

            try {
                const res = await fetch(`${API_BASE}/api/model_summary`);
                if (!res.ok) return;
                const data = await res.json();
                const m = data.metrics || {};

                const rf = m.rf || m.RandomForest || {};
                const en = m.elastic_net || m.ElasticNet || {};

                if (Object.keys(rf).length) {
                    rfEl.textContent =
                        `RandomForestï¼šRÂ²(test) = ${rf.R2_test?.toFixed?.(3) ?? rf.R2_test ?? "-"} ï½œ MAE = ${rf.MAE_test?.toFixed?.(3) ?? rf.MAE_test ?? "-"}`;
                }
                if (Object.keys(en).length) {
                    enEl.textContent =
                        `ElasticNetï¼šRÂ²(test) = ${en.R2_test?.toFixed?.(3) ?? en.R2_test ?? "-"} ï½œ MAE = ${en.MAE_test?.toFixed?.(3) ?? en.MAE_test ?? "-"}`;
                }
            } catch (err) {
                console.warn("è®€å– model_summary å¤±æ•—ï¼š", err);
            }
        }

        document
            .getElementById("train-form")
            .addEventListener("submit", trainModel);
        document
            .getElementById("btn-predict")
            .addEventListener("click", predictOnce);
    </script>
</body>

</html>